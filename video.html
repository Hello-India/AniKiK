<div id="player-container"></div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script>
  function getQueryParams() {
    const params = {};
    location.search.substring(1).split("&").forEach(pairStr => {
      const pair = pairStr.split("=");
      if(pair[0]) {
        params[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || "");
      }
    });
    return params;
  }

  const params = getQueryParams();
  const playerContainer = document.getElementById('player-container');

  if(params.video) {
    const videoUrl = params.video;

    // Extract YouTube video ID from different YouTube URL formats
    const ytRegex = /(?:youtube\.com\/(?:watch\?(?:.*&)?v=|embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
    const match = videoUrl.match(ytRegex);

    if(match) {
      const videoId = match[1];
      playerContainer.innerHTML = `
        <div class="plyr__video-embed" id="youtube-player">
          <iframe
            src="https://www.youtube.com/embed/${videoId}?si=OwXMS2pOmZx_l0di&origin=${location.origin}&iv_load_policy=3&modestbranding=1&playsinline=1"
            allowfullscreen
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            frameborder="0"
            referrerpolicy="strict-origin-when-cross-origin"
          ></iframe>
        </div>
      `;
      const player = new Plyr('#youtube-player');
    } else {
      // Fallback for MP4 videos
      playerContainer.innerHTML = `<video id="player" playsinline controls></video>`;
      const player = new Plyr('#player');
      const videoEl = document.getElementById('player');
      videoEl.src = videoUrl;
      videoEl.type = 'video/mp4';
    }
  } else {
    playerContainer.innerHTML = "<p>No video URL provided.</p>";
  }
</script>
